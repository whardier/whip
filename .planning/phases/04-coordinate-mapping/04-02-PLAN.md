---
phase: 04-coordinate-mapping
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/04-coordinate-mapping/verification-instructions.md
autonomous: false

must_haves:
  truths:
    - "Cursor reaches all four screen corners when canvas corners are clicked"
    - "Center of canvas maps to center of screen"
    - "Coordinate mapping works on Retina/HiDPI displays"
  artifacts:
    - path: ".planning/phases/04-coordinate-mapping/verification-instructions.md"
      provides: "Human testing instructions"
  key_links:
    - from: "static/index.html"
      to: "src/whip/controller.py"
      via: "Normalized coordinates (0-1)"
      pattern: "norm_x.*screen_width"
---

<objective>
Verify coordinate mapping accuracy on Retina displays and screen corners.

Purpose: Phase 3 implemented coordinate mapping from normalized browser coordinates to macOS screen pixels. Research confirms the implementation should work correctly (CGDisplayPixelsWide/High and pynput both use points), but COORD-04 (Retina accuracy) and COORD-05 (corner mapping) require human verification on actual hardware.

Output: Verification instructions and user confirmation of coordinate accuracy.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-coordinate-mapping/04-RESEARCH.md
@src/whip/controller.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create verification instructions and pause for human testing</name>
  <files>.planning/phases/04-coordinate-mapping/verification-instructions.md</files>
  <action>
Create a verification instructions file and then PAUSE for human verification.

**Create `.planning/phases/04-coordinate-mapping/verification-instructions.md` with:**

```markdown
# Coordinate Mapping Verification

## What Was Built

Phase 3 implemented coordinate mapping:
- Browser sends normalized coordinates (0.0-1.0 range) with 5 decimal precision
- Server uses CGDisplayPixelsWide/CGDisplayPixelsHigh to get screen dimensions
- Server multiplies normalized coords by screen dimensions
- pynput moves cursor to absolute position

Research confirms CGDisplayPixelsWide/High return POINTS (not pixels), which matches pynput's coordinate system. This should work correctly on Retina displays without any scaling.

## Prerequisites

1. Start server: `uv run uvicorn whip.main:app --host 0.0.0.0 --port 9447`
2. Open browser to http://localhost:9447
3. Note your screen resolution in the server startup log (e.g., "Screen size: 2560x1440")

## Test 1: Corner Mapping (COORD-05)

Move your mouse to each corner of the canvas and verify the macOS cursor reaches the corresponding screen corner:

| Canvas Position | Expected Screen Position |
|-----------------|-------------------------|
| Top-left corner | Top-left of screen |
| Top-right corner | Top-right of screen |
| Bottom-left corner | Bottom-left of screen |
| Bottom-right corner | Bottom-right of screen |

For each corner: The cursor should be within a few pixels of the actual screen edge/corner.

## Test 2: Center Mapping

Move your mouse to the center of the canvas. The macOS cursor should be near the center of your screen.

## Test 3: Retina Accuracy (COORD-04)

If you're on a Retina/HiDPI display:
- Confirm cursor movements are smooth (not jumping or jittery)
- Confirm clicking on canvas items maps accurately to screen position
- No "half-speed" movement or "only covers half the screen" issues

## Report Template

Reply with verification results:
- Display: [type and resolution]
- Top-left: PASS/FAIL
- Top-right: PASS/FAIL
- Bottom-left: PASS/FAIL
- Bottom-right: PASS/FAIL
- Center: PASS/FAIL
- Issues: [any observed problems, or "none"]
```

**After creating the file:**
- Print the verification instructions to the console
- STOP and wait for user to perform tests and report results
- This task requires human interaction (autonomous: false) - do not proceed until user provides verification results
  </action>
  <verify>
```bash
cat /Users/spencersr/tmp/whip/.planning/phases/04-coordinate-mapping/verification-instructions.md
```
  </verify>
  <done>
- Verification instructions file exists
- User has tested coordinate mapping on their hardware
- User has reported PASS/FAIL for all corners and center
- COORD-04 (Retina accuracy) and COORD-05 (corner mapping) verified
  </done>
</task>

</tasks>

<verification>
Human verifies coordinate mapping by testing corner positions and observing cursor behavior on their actual hardware.
</verification>

<success_criteria>
- All four corners map correctly (cursor reaches screen edges)
- Center of canvas maps to center of screen
- No accuracy issues on Retina displays
- COORD-04 and COORD-05 requirements confirmed
</success_criteria>

<output>
After completion, create `.planning/phases/04-coordinate-mapping/04-02-SUMMARY.md`
</output>
